import { faker } from "@faker-js/faker";
import { Dream } from "../models/dream";
import User from "../models/user";

/**
 * יוצר חלומות בעברית עם פירוש עשיר ומפורט.
 */
async function seedDreams(count: number = 10) {
  const existing = await Dream.find();
  if (existing.length > 0) {
    console.log("Dreams already exist, skipping...");
    return existing;
  }

  const users = await User.find();
  if (users.length === 0) {
    console.warn("⚠️ No users found! Please seed users first.");
    return [];
  }

  const dreamTemplates = [
    {
      title: "חלום על מים שזורמים בין הידיים",
      text: "ראיתי את עצמי עומד ליד נחל, מנסה לתפוס את המים אבל הם כל הזמן חומקים מבין האצבעות שלי. הרגשתי גם שלווה וגם תסכול.",
      interpretation:
        "המים מסמלים רגשות וזרימה פנימית. העובדה שאתה מנסה לאחוז בהם אך לא מצליח עשויה לרמוז על תחושת חוסר שליטה רגשית או קושי לשחרר. ייתכן שאתה מנסה לשמור על משהו שכבר הגיע הזמן לאפשר לו לזרום הלאה. הנחל בחלום מבטא תנועה טבעית של החיים, והמסר הוא ללמוד לסמוך על הזרימה הזו מבלי להילחם בה.",
    },
    {
      title: "נפילה ממגדל גבוה",
      text: "עמדתי בראש מגדל גבוה, הבטתי למטה ופתאום הקרקע נעלמה מתחתיי. נפלתי בתחושת פחד עצום עד שהתעוררתי מזיע.",
      interpretation:
        "נפילה מסמלת לעיתים אובדן ביטחון או פחד מכישלון. ייתכן שאתה עומד בפני שינוי משמעותי או החלטה גדולה בחיים שגורמת לך לחשוש מאיבוד אחיזה. יחד עם זאת, החלום גם רומז על צורך לשחרר שליטה ולתת אמון בתהליך. ייתכן שדווקא דרך הוויתור תמצא קרקע יציבה חדשה.",
    },
    {
      title: "חלום על תעופה חופשית בשמיים",
      text: "חלמתי שאני עף גבוה מעל הערים, מסתכל על העולם מלמעלה, מרגיש חופש מוחלט.",
      interpretation:
        "עוף בחלום מסמל חופש, העצמה ושחרור ממגבלות. ייתכן שהחלום מבטא תקופה שבה אתה מתרחק מהיומיומי כדי לראות דברים בפרספקטיבה רחבה יותר. לעיתים תעופה מעידה על שאיפה רוחנית או רצון לפרוץ את הגבולות הקיימים. זהו חלום חיובי המצביע על התפתחות וצמיחה פנימית.",
    },
    {
      title: "שן נופלת באמצע שיחה",
      text: "דיברתי עם מישהו ופתאום הרגשתי שן מתנדנדת ונופלת לי מהפה. ניסיתי להחזיר אותה למקום ולא הצלחתי.",
      interpretation:
        "שיניים נופלות בחלום קשורות לרוב לתחושת חוסר ביטחון או פחד מאיבוד כוח אישי. זה יכול להיות קשור לדימוי עצמי, לתקשורת או ליחסים. ייתכן שאתה מרגיש שאינך מצליח לבטא את עצמך בצורה מספקת. המסר של החלום הוא למצוא מחדש את תחושת הערך העצמי והביטחון בקול שלך.",
    },
    {
      title: "מרדף מסתורי ברחובות חשוכים",
      text: "מישהו רדף אחריי ברחובות לילה ריקים. לא הצלחתי לראות את פניו, רק שמעתי את הצעדים מאחוריי.",
      interpretation:
        "המרדף מסמל פחדים לא מודעים או נושאים שאתה נמנע מלהתמודד איתם. הדמות שרודפת אחריך מייצגת חלקים לא פתורים בתודעה שלך – אולי רגש, חרטה או דפוס התנהגות. החלום מזמין אותך להביט לאחור ולהתמודד במקום לברוח.",
    },
    {
      title: "חלום על ים סוער",
      text: "מצאתי את עצמי בלב ים, הגלים היו עצומים והרוח חזקה. הרגשתי שאני נמשך מטה אבל גם נלחם כדי לצוף.",
      interpretation:
        "ים סוער בחלום הוא סמל קלאסי לעולם רגשי סוער. אתה כנראה עובר תקופה של חוסר יציבות או סערה פנימית. הגלים מסמלים רגשות עזים – פחד, כעס, אהבה או חוסר ודאות. עצם העובדה שאתה נלחם כדי להישאר מעל פני המים מראה על כוחות הישרדות ויכולת להתמודד עם קשיים.",
    },
  ];

  const dreams = Array.from({ length: count }, () => {
    const randomUser = faker.helpers.arrayElement(users);
    const template = faker.helpers.arrayElement(dreamTemplates);

    return {
      userId: randomUser._id,
      title: template.title,
      userInput: template.text,
      aiResponse: template.interpretation,
      isShared: faker.datatype.boolean(),
      createdAt: faker.date.recent({ days: 90 }),
      updatedAt: new Date(),
    };
  });

  const created = await Dream.insertMany(dreams);
  console.log(`✅ Inserted ${created.length} enriched Hebrew dreams`);
  return created;
}

export default seedDreams;
